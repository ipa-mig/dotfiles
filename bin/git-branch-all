#!/bin/bash

###
### Script for checking the branches in all packages
###

# checking input parameters
if [[ "$#" -ge 2 || "$#" -eq 0 ]]; then
        echo "ERROR: Wrong number of parameters"
        echo "Usage: git_branch_all.sh <outputfile>"
        exit 1
else
        fileout=$PWD/$1
fi

# get all installed stacks
ls -l $PWD | grep '^d' | awk '{print $9}' > /tmp/stacks_tmp.txt

output=/tmp/output

# check git status for stacks
echo "--- Check git branch for all stacks! ---" > $output
echo "" >> $output

while read line
do
    pushd $PWD/$line > /dev/null

	  echo "__ git branch for stack: $line __" >> $output
 	  git branch >> $output
  	echo "" >> $output

    popd > /dev/null
done < /tmp/stacks_tmp.txt

# clean up tmp files
rm /tmp/stacks_tmp.txt
cat $output

cat $output > $fileout

rm $output

exit
